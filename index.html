
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SiderAlba</title>

    <link rel="icon" href="static\icon.png" sizes="192x192" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.2/assets/css/docs.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>

    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        body {
            padding: 10px;
        }

        .righe {
            padding: 5px;
        }

        hr {
            margin: 5px;
        }

        .txt1 {
            margin: 5px;
        }

        .right {
            padding: 5px 5px;
            /* border: 3px solid green; */
            text-align: right;
        }

        .center {
            padding: 50px 0;
            /* border: 3px solid green; */
            text-align: center;
        }
    </style>
</head>

<body>
    <table class="table">
        <tr>
            <td> <img src="static\log01.png" alt="LOGO"></td>
            <td>
                <h2 class="">Produzione giornaliera</h2>
            </td>
        </tr>
    </table>

    <div class="right">
        <h2 id="Obbi">Obiettivo <span style='font-size:3vw; color: green;'>1.000</span> Tons</h2>
    </div>

    <div class="center">
        <h1 id="Media">...</h1>
        <br>
        <h3 id="Data">...</h3>
    </div>

    <div id="chart_div" style="height: 200px; margin-top: 50px;" class=""></div>

    <script>
        var firebaseConfig = {
            apiKey: "",
            databaseURL: "https://sideralbamanutenzione-default-rtdb.europe-west1.firebasedatabase.app/",
        };
        firebase.initializeApp(firebaseConfig);

        var database = firebase.database();
        var Prod = database.ref("Produzione");

        var Anno = "2024";
        var Mese = "04";

        var Media = 0;
        var TotMese = 0;
        var Conta = 0;

        var Rigo1 = "Media giornaliera <span style='font-size:10vw; color: red;'>...</span>Tons";
        
        Prod.child("Oggi").on('value', function (sn) {
            // document.getElementById('Tons').innerHTML = Rigo1.replace("...", sn.child("ID1").val());
            document.getElementById('Data').innerHTML = "" + sn.child("Data").val() + "";
        });

        var myData = [['Giorno', 'Tons', { role: 'style' }, { role: 'annotation' }]];

        Prod.child("Monitor").child(Anno).child(Mese).on('value', function (snapshot) {

            myData = [['Giorno', 'Tons', { role: 'style' }, { role: 'annotation' }]];
            Media = 0;
            TotMese = 0;
            Conta = 0;

            snapshot.forEach(function (cs) {
                // console.log("myData " + myData);
                var Etichetta = cs.val() != 0 ? cs.val() : '';
                myData.push([cs.key, Etichetta, 'blue', "" + Etichetta]);

                if (cs.val() > 0) {
                    TotMese += cs.val();
                    Conta += 1;
                }
            });

            document.getElementById('Media').innerHTML = Rigo1.replace("...", Math.floor(TotMese / Conta));

            google.charts.setOnLoadCallback(drawChart);
        });


        google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {

            var data = google.visualization.arrayToDataTable(myData);

            var options = {
                title: 'Produzione giornaliera',
                hAxis: {
                    title: 'Giorno'
                },
                vAxis: {
                    title: 'Tons',
                    minValue: 0,
                    maxValue: 1000
                },
                legend: 'none',
                annotations: {
                    // alwaysOutside: true,
                    textStyle: {
                        fontSize: 10,
                        // fontName: 'Arial',
                        // auraColor: 'none',
                    }
                }
            };

            var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }

        // ASSENZA CONNESSIONE ==============
        var connectedRef = firebase.database().ref(".info/connected");
        connectedRef.on("value", (snap) => {
            if (snap.val() === true) {
                console.log("connected");
                //document.getElementById("d0").className = "btn btn-outline-success";
            } else {
                console.log("not connected");
                //document.getElementById("d0").className = "btn btn-danger";
            }
        });
    </script>
</body>

</html>
